# This is edit_repos.Rmd
Note: This is a updated file to `edit_webapps.rmd` in the ohi-webapps@dev branch. 

## Initial Setup

NOTE:: must add info by hand to `ohi-webapps/custom/sc_studies_custom.csv`

```{r setup}
## set key ----
key <- 'cnc'

## setup ----
source('~/github/ohi-webapps/_source_and_load.r')
setwd(dir_webapps)
source(file.path(dir_webapps, 'create_init.R'))
source(file.path(dir_webapps, 'create_init_sc.R'))
```


## Create Starter Repo

```{r}
## create github repo on github.com
create_gh_repo(key, gh_token, github_user)

## set working dir
dir.create(dir_repo)

## add readme and prep folder
populate_init(key)
populate_prep(key)
```

## Inspect user's shapefiles and save as OHI shapefiles

This occurs in the /custom folder. A running list: 

- chl/prep_chl.rmd
- cnc/prep_cnc.Rmd
- rdv/prep_rdv.rmd
- arc/prep_arc.Rmd


## Clone existing repo

```{r clone existing repo, eval=FALSE}
## clone chl repo
unlink(dir_repo, recursive=T, force=T)
repo <- clone(git_url, normalizePath(dir_repo, mustWork=F))
setwd(dir_repo)
```

## Potential Step(s) Here

- Unpopulate Existing Repo (see chunk below)

## Populate Full Repo
This doesn't push, just populates.

```{r populate, eval=F}
## populate layers folder and layers.csv, and conf
populate_layers(key, dir_repo, lyrs_gl, dir_global, dir_scenario, multi_nation = FALSE)
populate_conf(key, dir_scenario, dir_global) ## look at TODOs in functions.r
populate_etc(key, dir_scenario)

## create repo's maps
create_repo_map(key, dir_spatial, dir_scenario) 

## if there is a prep repo, move it within the scenario folder
dir_prep  <- file.path(dir_repo,     'prep')
dir_prep2 <- file.path(dir_scenario, 'prep')
if (dir.exists(dir_prep)) system(sprintf('mv %s/ %s/', dir_prep, dir_prep2))
```

## Calculate scores and create scores.csv
Can also test this from the repo itself (open the the clip-n-ship/key/.rproj)

```{r calculate, eval=F}
## calculate scores and create scores.csv
calculate_scores_check()
```

## Push!

```{r push, eval=F}
# push repo
setwd(dir_repo)
push_branch(branch = 'master', current_msg = 'created full repo') 
```

## Rename draft to master

```{r, eval=F}

system('git status')
system('git branch -m draft master')
system('git branch')

## Then delete on GitHub and repush http://stackoverflow.com/questions/9524933/renaming-a-branch-in-github
push_branch(branch = 'master', current_msg = 'renamed draft branch to master branch') 

```

# Other functionality

## Unpopulate Existing Repo
(Optional)
Delete contents so can start afresh, for example if a full repo exists but needs to be recreated with more regions. After

```{r unpopulate, eval=F}
## rename subcountry2014 -> region2016. 
file.rename(from = file.path(dir_repo, 'subcountry2014'),
            to   = file.path(dir_repo, 'region2016'))

## unpopulate_layers_conf
unpopulate_layers_conf(key, dir_repos, dir_repo, git_url, default_scenario)

## a few extra files to delete from CHL: 
also_delete <- paste(dir_repo, 
                     c('copy_webapps_templates.r', 'ohi-travis-functions.R', 'travis-tool.sh'), sep = '/')
unlink(also_delete, recursive = TRUE, force = TRUE)
```



